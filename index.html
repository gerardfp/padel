<!DOCTYPE html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<!--
alberto
blanca
carlos
david 
eugenio 
fernando 
gerard
hector
ismael
jordi
kevin andres miguel
luis miguel
manuel
nestor
octavio
paco
-->

<div style="font-family:sans-seriff; margin: auto; max-width: 800px; display: flex; flex-direction: column; gap: 2.2em;align-items: center;">
	<div id="configScreen" style="padding:0.5em; background: orange; display: flex; flex-direction: column; width: 100%;">
		<p>JUGADORES</p>
		<textarea id="inputplayers" rows=18 cols=40>
a
b
c
d
e
f
g
h
i
j
k
l
m
n
o
p
		</textarea>
		<p>Players: <span id="numplayers"></span></p>
		<button id="start" style="padding:0.8em">START TOURNAMENT</button>
	</div>

	<div id="tournamentScreen" style="padding:0.5em; width: 100%; background: greenyellow; display: flex; flex-direction: column;"  >
		<p>RONDA</p>
		<div id="showCurrentMatches"></div>
		<button style="padding:0.8em" id="saveButton">SAVE SCORES</button>
	</div>

	<div id="classificacionScreen" style="padding:0.5em; width: 100%; background: violet; display: flex; flex-direction: column;"  >
		<p>CLASIFICACION</p>
		<div id="showAllMatches"> 
			
		</div>
	</div>
</div>



<script>


let players = [];
let matches = [];
let pairs = [];
let currentMatches = [];

players = inputplayers.value.split('\n').filter(row => row.trim().length > 0);
numplayers.innerText=players.length;

pair();

inputplayers.oninput = (e) => {
	players = inputplayers.value.split('\n').filter(row => row.trim().length > 0);
	numplayers.innerText=players.length;
}

start.onclick = (e) => {
	pair();
	shuffle();
}

saveButton.onclick = (e) => {
	save();
	show();
	shuffle();
}

function pair() {
	let mts = [];

	for (let i=0; i<players.length; i++) {
		for (let j=i+1; j<players.length; j++) {
			for(let k=i+1; k<players.length; k++) {
				if (k==j) continue;
				for(let l=k+1; l<players.length; l++) {
					if (l==j || l==k) continue;
					
					pairs.push({p1:players[i], p2:players[j], p3:players[k], p4:players[l]});

					// console.log(`${players[i]} - ${players[j]}  VS ${players[k]} - ${players[l]}`);

					// let parella1 = `${players[i]}${players[j]}`
					// if(vaDavant(players[j], players[i])) {
					// 	parella1 = `${players[j]}${players[i]}`
					// }
					// let parella2 = `${players[k]}${players[l]}`
					// if(vaDavant(players[l], players[k])) {
					// 	parella2 = `${players[l]}${players[k]}`
					// }

					// let mstr = `${parella1}${parella2}`;
					// if(vaDavant(parella2, parella1)){
					// 	mstr = `${parella2}${parella1}` ;
					// }
					// mts.push(mstr)
				}
			}
		}
	}

	//mts.sort();
	//for(let i=0; i<mts.length; i++) {
	//	console.log(mts[i]);
	//}
	//console.log(mts.length);

}


function shuffle() {
	const numMatches = Math.floor(players.length / 4);
	const available = [...players];
	currentMatches = [];

	while(currentMatches.length < numMatches){

		const match = {};

		let i=100;
		while(i--) {
			match.id = makeid();
			match.p1 = getRandom(available);
			match.p2 = getRandom(available);
			match.p3 = getRandom(available);
			match.p4 = getRandom(available);

			if (currentMatches.find(m => compareMatches(match, m))) {
				console.log("yeaaa");
			} else {
				break;
			}
		}
		if (!match.p4) {
			console.log("no se encontro jugador disponible.... :/")
		}
		currentMatches.push(match);
	}
	
	let ih = "";
	let i = 1;
	for (const match of currentMatches) {
		ih += `
		<div style="margin-bottom:1em; background:lightgray; border:1px solid black; ">
			<div>Pista ${i}</div>
			<div style="text-align:center">
				<div style="background:lightblue">${match.p1} - ${match.p2}</div>
				<input id="${match.id}-a" style="padding:0.8em" type="number" min=0 max=100>
			</div>
			<div style="background:#ff4466; text-align:center">VS</div>
			<div style="text-align:center">
				<input id="${match.id}-b" type="number" min=0 max=100 style="padding:0.8em">
				<div style="background:lightblue">${match.p3} - ${match.p4}</div>
			</div>
		</div>
		`
		i++;
	}
	showCurrentMatches.innerHTML = ih;
}

function save(){
	for (const match of currentMatches) {
		match.points12 = document.querySelector(`#${match.id}-a`).value;
		match.points34 = document.querySelector(`#${match.id}-b`).value;	
	}
	
	matches = [...matches, ...currentMatches];
}

function show(){
	let ih = "";
	for (const match of matches) {
	ih += `
		<p>${match.p1} - ${match.p2}  [${match.points12}] <span style="color:red">VS</span> [${match.points34}]  ${match.p3} - ${match.p4}</p>
	`
		showAllMatches.innerHTML = ih;
	
	}
}


function getRandom(array) {
	//return array[(Math.random() * array.length) | 0]
	return array.splice((Math.random() * array.length) | 0, 1)[0]
}

function compareMatches(a,b) {
	return a.p1===b.p1 && a.p2===b.p2 && a.p3===b.p3 && a.p4===b.p4
}

function vaDavant(a,b) {
	if (a.charAt(0) < b.charAt(0)) {
		//console.log(`${a} vadavent de ${b}`)
		return true;
	}
	// console.log(`${b} vadavent de ${a}`)
	return false;
}

function makeid() {
    let result = '';
    const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
    const charactersLength = characters.length;
    let counter = 0;
    while (counter < 10) {
      result += characters.charAt(Math.floor(Math.random() * charactersLength));
      counter += 1;
    }
    return result;
}

</script>


